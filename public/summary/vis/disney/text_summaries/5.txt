Newlyweds Shrek and Princess Fiona return from their honeymoon to find they have been invited by Fiona's parents to a royal ball to celebrate their marriage. Though Shrek is mortified about visiting the kingdom as an ogre, and resents Fiona's parents for locking her in the tower, Fiona convinces him to attend, and they travel to the kingdom of Far Far Away with Donkey in tow and the fairy tale creatures house sitting. They meet Fiona's parents, King Harold and Queen Lillian, who are repulsed to see they are ogres. At dinner, Shrek and Harold get into a heated argument, and afterwards, Fiona encounters Fairy Godmother, a celebrity potions saleswoman who offers to help Fiona but is mortified to see she is married to Shrek. Shrek worries he is losing Fiona, especially after finding her childhood diary and reading that she was once seemingly infatuated with Prince Charming.
Harold is secretly reprimanded by Fairy Godmother, who had arranged with Harold for her son—Charming—to be the one to rescue and marry Fiona; she hopes to use the marriage to rule Far Far Away through Charming. She orders Harold to get rid of Shrek or else lose his own happy ending, so Harold hires swashbuckling outlaw and mercenary Puss in Boots to assassinate Shrek.
Unable to overpower Shrek, Puss reveals that he was paid by Harold and offers to help him in gratitude for having his own life spared. Shrek, Donkey, and Puss meet with Fairy Godmother at her potions factory to find something to help Shrek appeal to Fiona, but she coldly rejects his request, insisting ogres do not deserve happy endings. They retaliate by stealing a potion labeled "Happily Ever After" and accidentally trashing the factory. Shrek and Donkey drink the potion and soon fall asleep. Back in Far Far Away, Fiona notices Shrek is missing and tries to find him, but she too falls asleep.
The next morning, Shrek and Fiona awaken to find they are now human, and Donkey is a white stallion. To make the change permanent, Shrek must kiss Fiona by midnight. Shrek, Donkey, and Puss return to the castle; however, Fairy Godmother, having discovered the theft, has sent Charming to pose as human Shrek and win Fiona's love. At Fairy Godmother's urging, Shrek leaves the castle, believing that the best way to make Fiona happy is to let her go.
Fiona is skeptical of Charming; therefore, to ensure the two will wed, Fairy Godmother gives Harold a love potion to put into Fiona's tea. This exchange is overheard by Shrek, Donkey, and Puss, who are arrested by the royal knights after Donkey inadvertently exposes them. While the ball begins, the fairy tale creatures - having seen the arrest on the news - rescue the trio from the dungeon. They all storm the castle with the help of Mongo, a monstrous living gingerbread man created by the Muffin Man.
Though Mongo is destroyed, the group manages to break into the ball. Shrek fails to prevent Charming from kissing Fiona, but instead of falling in love, Fiona knocks him out. Harold reveals that he swapped Fiona's tainted teacup with his own, refusing to go through with the plot. Livid, the Fairy Godmother tries to strike Shrek with a spell from her magic wand. Harold jumps in front of it and is struck; the rest of the spell reflects off his breastplate and hits the Fairy Godmother, causing her to disintegrate into bubbles.
Harold reverts to his true form as the Frog Prince, having used the "Happily Ever After" potion years earlier to gain Lillian's love. He approves of Shrek and Fiona's marriage, while Lillian assures Harold that she still loves him. As the clock strikes midnight, Fiona declines Shrek's offer to remain human, and they revert to ogres, while Donkey also returns to normal, much to his sadness. Everyone celebrates as the ball continues. In a mid-credits scene, Dragon, who had recently married Donkey, arrives with several dragon-donkey hybrid babies.